"use strict";(self.webpackChunkprotego=self.webpackChunkprotego||[]).push([[274],{6274:(Q,x,i)=>{i.r(x),i.d(x,{ProfileModule:()=>z});var d=i(9808),U=i(869),v=i(1402),l=i(3075),e=i(5e3),u=i(8966),m=i(162),C=i(5144),P=i(8128),T=i(2313),b=i(6239),h=i(7322),Z=i(5245),O=i(7423),_=i(4894);function w(r,n){if(1&r&&(e.TgZ(0,"mat-error",11)(1,"mat-icon"),e._uU(2,"error_outline"),e.qZA(),e._uU(3),e.ALo(4,"translate"),e.qZA()),2&r){const t=e.oxw();e.xp6(3),e.hij(" ",e.lcZ(4,1,t.error)," ")}}function M(r,n){if(1&r&&(e._UZ(0,"img",12),e.ALo(1,"translate")),2&r){const t=e.oxw();e.s9C("alt",e.lcZ(1,2,"protego.dialog-box.alt")),e.Q6J("src",t.sanitizer.bypassSecurityTrustUrl(t.url),e.LSH)}}const F=function(r){return{"protego-drag-over":r}};function L(r,n){if(1&r){const t=e.EpF();e.TgZ(0,"label",13),e.NdJ("fileOver",function(a){return e.CHM(t),e.oxw().fileOver(a)}),e.TgZ(1,"div",14)(2,"span"),e._uU(3),e.ALo(4,"translate"),e._UZ(5,"br"),e._uU(6),e.ALo(7,"translate"),e.qZA()()()}if(2&r){const t=e.oxw();e.Q6J("ngClass",e.VKq(8,F,t.hasDragOver))("uploader",t.uploader),e.xp6(3),e.Oqu(e.lcZ(4,4,"protego.dialog-box.inst1")),e.xp6(3),e.Oqu(e.lcZ(7,6,"protego.dialog-box.inst2"))}}function S(r,n){if(1&r&&e._UZ(0,"input",15),2&r){const t=e.oxw();e.Q6J("uploader",t.uploader)}}let y=(()=>{class r{constructor(t,o,a,s,p,f){this.dialogRef=t,this.sanitizer=o,this.usersService=a,this.notificationService=s,this.tokenService=p,this.data=f,this.EXT_LIST=[".jpg",".png",".gif"],this.hasDragOver=!1,this.processing=!1,this.editmode=!0,this.urlChange=new e.vpe,this.uploader=new m.bA({url:""}),this.uploader.onAfterAddingFile=c=>{if(this.validateFile(c._file)){let R=window.URL?window.URL.createObjectURL(c._file):window.webkitURL.createObjectURL(c._file);this.url=R;const A=new FormData;A.append("file",c._file,c._file.name),this.file=A}}}ngOnInit(){this.username=this.tokenService.username,this.getUserPhoto(this.username)}getUserPhoto(t){this.usersService.getUserPhoto(t).subscribe({next:o=>this.url="data:image/gif;base64,"+o,error:o=>console.log(o)})}doAction(){this.saveUserPhoto(),this.closeDialog()}closeDialog(){this.dialogRef.close()}saveUserPhoto(){this.usersService.updateUserPhoto(this.username,this.file).subscribe({next:()=>this.notificationService.success("Photo Updated"),error:t=>console.log(t)})}fileOver(t){this.hasDragOver=t}validateFile(t){const o=t.name,a=t.size,s=o.substring(o.lastIndexOf("."));let p=!0;return this.error="",this.EXT_LIST.indexOf(s)<0&&(p=!1,this.error="protego.dialog-box.warn1"),a>512e3&&(p=!1,this.error="protego.dialog-box.warn2"),p}}return r.\u0275fac=function(t){return new(t||r)(e.Y36(u.so),e.Y36(T.H7),e.Y36(C.f),e.Y36(b.g),e.Y36(P.B),e.Y36(u.WI,8))},r.\u0275cmp=e.Xpm({type:r,selectors:[["app-dialog-box"]],inputs:{editmode:"editmode",url:"url"},outputs:{urlChange:"urlChange"},decls:19,vars:19,consts:[["mat-dialog-title",""],["mat-dialog-subtitle",""],["class","protego-error-container",4,"ngIf"],["mat-dialog-content",""],[1,"protego-profile-picture"],["width","300","height","300",3,"src","alt",4,"ngIf"],["for","uploader-input","ng2FileDrop","",3,"ngClass","uploader","fileOver",4,"ngIf"],["type","file","name","file","ng2FileSelect","","id","uploader-input","style","display: none;",3,"uploader",4,"ngIf"],["mat-dialog-actions",""],["mat-raised-button","","color","primary",3,"click"],["mat-button","","mat-flat-button","",3,"click"],[1,"protego-error-container"],["width","300","height","300",3,"src","alt"],["for","uploader-input","ng2FileDrop","",3,"ngClass","uploader","fileOver"],[1,"protego-infotext"],["type","file","name","file","ng2FileSelect","","id","uploader-input",2,"display","none",3,"uploader"]],template:function(t,o){1&t&&(e.TgZ(0,"h1",0),e._uU(1),e.ALo(2,"translate"),e.qZA(),e.TgZ(3,"p",1),e.YNc(4,w,5,3,"mat-error",2),e.qZA(),e.TgZ(5,"div",3)(6,"div",4),e.YNc(7,M,2,4,"img",5),e.YNc(8,L,8,10,"label",6),e.YNc(9,S,1,1,"input",7),e.qZA()(),e.TgZ(10,"div",8)(11,"button",9),e.NdJ("click",function(){return o.doAction()}),e.ALo(12,"translate"),e._uU(13),e.ALo(14,"translate"),e.qZA(),e.TgZ(15,"button",10),e.NdJ("click",function(){return o.closeDialog()}),e.ALo(16,"translate"),e._uU(17),e.ALo(18,"translate"),e.qZA()()),2&t&&(e.xp6(1),e.Oqu(e.lcZ(2,9,"protego.dialog-box.title")),e.xp6(3),e.Q6J("ngIf",o.error),e.xp6(3),e.Q6J("ngIf",o.url),e.xp6(1),e.Q6J("ngIf",o.editmode),e.xp6(1),e.Q6J("ngIf",o.editmode),e.xp6(2),e.uIk("aria-label",e.lcZ(12,11,"protego.dialog-box.aria1")),e.xp6(2),e.Oqu(e.lcZ(14,13,"protego.dialog-box.button1")),e.xp6(2),e.uIk("aria-label",e.lcZ(16,15,"protego.dialog-box.aria2")),e.xp6(2),e.Oqu(e.lcZ(18,17,"protego.dialog-box.button2")))},directives:[u.uh,d.O5,h.TO,Z.Hw,u.xY,m.GN,d.mk,m.C6,u.H8,O.lW],pipes:[_.X$],styles:[".protego-profile-picture[_ngcontent-%COMP%]{position:relative;z-index:1;width:300px;height:300px;background-size:contain;border-radius:1em;margin:auto}.protego-profile-picture[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:300px;height:300px;position:absolute;z-index:2;border-radius:50%}.protego-profile-picture[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{width:300px;height:300px;position:relative;z-index:3;cursor:pointer}.protego-profile-picture[_ngcontent-%COMP%]   .protego-drag-over[_ngcontent-%COMP%]   .protego-infotext[_ngcontent-%COMP%]{color:#fff;border:dashed 5px white}.protego-profile-picture[_ngcontent-%COMP%]   .protego-infotext[_ngcontent-%COMP%]{position:absolute;margin-left:5px;margin-top:5px;height:290px;width:290px;vertical-align:middle;text-align:center;text-shadow:-1px 1px 0 #000,1px 1px 0 #000,1px -1px 0 #000,-1px -1px 0 #000;color:#fffc;border:dashed 3px rgba(255,255,255,.8);border-radius:50%;padding-top:110px;font-size:150%}.protego-profile-photo[_ngcontent-%COMP%]{position:absolute;width:100%;height:100%}.protego-page-container[_ngcontent-%COMP%]{width:60%;margin:auto;padding-top:1em}.protego-full-width[_ngcontent-%COMP%]{width:100%}.protego-card-header-image[_ngcontent-%COMP%]{background-size:cover}.protego-error-container[_ngcontent-%COMP%]{text-align:center}.protego-error-container[_ngcontent-%COMP%] > mat-icon[_ngcontent-%COMP%]{vertical-align:middle}.mat-dialog-content[_ngcontent-%COMP%]{min-height:300px}"]}),r})();var J=i(7182),D=i(4540),g=i(9224),N=i(7238),I=i(7531);function Y(r,n){1&r&&(e.TgZ(0,"mat-error")(1,"mat-icon",9),e._uU(2,"error_outline"),e.qZA(),e._uU(3),e.ALo(4,"translate"),e.qZA()),2&r&&(e.xp6(3),e.hij(" ",e.lcZ(4,1,"protego.profile.firstname.warn")," "))}function k(r,n){1&r&&(e.TgZ(0,"mat-error")(1,"mat-icon",9),e._uU(2,"error_outline"),e.qZA(),e._uU(3),e.ALo(4,"translate"),e.qZA()),2&r&&(e.xp6(3),e.hij(" ",e.lcZ(4,1,"protego.profile.lastname.warn")," "))}const q=[{path:"",component:(()=>{class r{constructor(t,o,a,s,p,f){this.dialog=t,this.usersService=o,this.fb=a,this.communicationService=s,this.notificationService=p,this.tokenService=f,this.submitted=!1,this.user=new J.n}ngOnInit(){this.userForm=this.fb.group({first_name:["",[l.kI.required]],last_name:["",l.kI.required]}),this.username=this.tokenService.username,this.userRole=this.tokenService.role,this.getUser(this.username)}get userFormControl(){return this.userForm.controls}getUser(t){this.usersService.getUser(t).subscribe({next:o=>{this.user=o,this.initForm(o),this.getUserPhoto(o.username)},error:o=>console.log(o)})}initForm(t){this.user=t,this.userForm.controls.first_name.setValue(t.first_name),this.userForm.controls.last_name.setValue(t.last_name)}getUserPhoto(t){this.usersService.getUserPhoto(t).subscribe({next:o=>{this.photoUrl="data:image/gif;base64,"+o,this.communicationService.emitChange({username:t,role:this.userRole,profilePhoto:this.photoUrl})},error:o=>console.log(o)})}openDialog(){this.dialog.open(y,{width:"400px",disableClose:!0}).afterClosed().subscribe(()=>{this.getUserPhoto(this.user.username)})}updateFirstName(t){this.user.first_name=t.target.value}updateLastName(t){this.user.last_name=t.target.value}saveUser(){this.user&&(this.user.updated_by=this.user.username),this.userForm.valid&&this.user&&this.usersService.updateUser(this.user).subscribe({next:()=>this.notificationService.success("Save Successful"),error:t=>console.log(t)})}}return r.\u0275fac=function(t){return new(t||r)(e.Y36(u.uw),e.Y36(C.f),e.Y36(l.qu),e.Y36(D.W),e.Y36(b.g),e.Y36(P.B))},r.\u0275cmp=e.Xpm({type:r,selectors:[["profile"]],decls:27,vars:28,consts:[[1,"protego-page-container"],[2,"margin-bottom","1em"],["mat-card-avatar","",1,"protego-card-header-image",3,"src","matTooltip","alt","click"],[1,"protego-form",3,"formGroup"],[1,"protego-full-width"],["matInput","","formControlName","first_name","required","",3,"placeholder","keyup"],[4,"ngIf"],["matInput","","formControlName","last_name","required","",3,"placeholder","keyup"],["mat-raised-button","","color","primary",1,"protego-save-button",3,"disabled","click"],[2,"margin-right","2px"]],template:function(t,o){1&t&&(e.TgZ(0,"div",0)(1,"p",1),e._uU(2),e.ALo(3,"translate"),e.qZA(),e.TgZ(4,"mat-card")(5,"mat-card-header")(6,"img",2),e.NdJ("click",function(){return o.openDialog()}),e.ALo(7,"translate"),e.ALo(8,"translate"),e.qZA(),e.TgZ(9,"mat-card-title"),e._uU(10),e.qZA(),e.TgZ(11,"mat-card-subtitle"),e._uU(12),e.qZA()(),e.TgZ(13,"mat-card-content")(14,"form",3)(15,"mat-form-field",4)(16,"input",5),e.NdJ("keyup",function(s){return o.updateFirstName(s)}),e.ALo(17,"translate"),e.qZA(),e.YNc(18,Y,5,3,"mat-error",6),e.qZA(),e.TgZ(19,"mat-form-field",4)(20,"input",7),e.NdJ("keyup",function(s){return o.updateLastName(s)}),e.ALo(21,"translate"),e.qZA(),e.YNc(22,k,5,3,"mat-error",6),e.qZA()()(),e.TgZ(23,"button",8),e.NdJ("click",function(){return o.saveUser()}),e.ALo(24,"translate"),e._uU(25),e.ALo(26,"translate"),e.qZA()()()),2&t&&(e.xp6(2),e.Oqu(e.lcZ(3,14,"protego.profile.info")),e.xp6(4),e.s9C("matTooltip",e.lcZ(7,16,"protego.profile.tooltip")),e.s9C("alt",e.lcZ(8,18,"protego.profile.alt")),e.Q6J("src",o.photoUrl,e.LSH),e.xp6(4),e.Oqu(o.user.username),e.xp6(2),e.Oqu(o.user.email),e.xp6(2),e.Q6J("formGroup",o.userForm),e.xp6(2),e.s9C("placeholder",e.lcZ(17,20,"protego.profile.firstname")),e.xp6(2),e.Q6J("ngIf",(o.userFormControl.first_name.touched||o.submitted)&&(null==o.userFormControl.first_name.errors?null:o.userFormControl.first_name.errors.required)),e.xp6(2),e.s9C("placeholder",e.lcZ(21,22,"protego.profile.lastname")),e.xp6(2),e.Q6J("ngIf",(o.userFormControl.last_name.touched||o.submitted)&&(null==o.userFormControl.last_name.errors?null:o.userFormControl.last_name.errors.required)),e.xp6(1),e.Q6J("disabled",!o.userForm.valid),e.uIk("aria-label",e.lcZ(24,24,"protego.profile.aria")),e.xp6(2),e.Oqu(e.lcZ(26,26,"protego.profile.button")))},directives:[g.a8,g.dk,g.kc,N.gM,g.n5,g.$j,g.dn,l._Y,l.JL,l.sg,h.KE,I.Nt,l.Fj,l.JJ,l.u,l.Q7,d.O5,h.TO,Z.Hw,O.lW],pipes:[_.X$],styles:[".protego-page-container[_ngcontent-%COMP%]{width:20%;min-width:400px;margin:auto;padding-top:1em}.protego-full-width[_ngcontent-%COMP%]{width:100%}.protego-card-header-image[_ngcontent-%COMP%]{background-size:cover;cursor:pointer}@media (min-width: 0){.protego-page-container[_ngcontent-%COMP%]{width:90%}}@media (min-width: 600px){.protego-page-container[_ngcontent-%COMP%]{width:50%}}@media (min-width: 900px){.protego-page-container[_ngcontent-%COMP%]{width:40%}}@media (min-width: 1200px){.protego-page-container[_ngcontent-%COMP%]{width:30%}}@media (min-width: 1500px){.protego-page-container[_ngcontent-%COMP%]{width:20%}}"]}),r})(),data:{title:"protego.menu.profile"}}];let B=(()=>{class r{}return r.\u0275fac=function(t){return new(t||r)},r.\u0275mod=e.oAB({type:r}),r.\u0275inj=e.cJS({imports:[[v.Bz.forChild(q)],v.Bz]}),r})(),z=(()=>{class r{}return r.\u0275fac=function(t){return new(t||r)},r.\u0275mod=e.oAB({type:r}),r.\u0275inj=e.cJS({imports:[[d.ez,U.m,B]]}),r})()}}]);