{"ast":null,"code":"import { EventEmitter } from '@angular/core';\nimport { MatDialogRef, MAT_DIALOG_DATA } from '@angular/material/dialog';\nimport { DomSanitizer } from '@angular/platform-browser';\nimport { FileUploader } from 'ng2-file-upload';\nimport { UsersService } from '../../../features/admin/users/users.service';\nimport { NotificationService } from '../../../core/notifications/notification.service';\nimport { TokenService } from '../../../shared/services/token.service';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/material/dialog\";\nimport * as i2 from \"@angular/platform-browser\";\nimport * as i3 from \"../../../features/admin/users/users.service\";\nimport * as i4 from \"../../../core/notifications/notification.service\";\nimport * as i5 from \"../../../shared/services/token.service\";\nimport * as i6 from \"@angular/common\";\nimport * as i7 from \"@angular/material/form-field\";\nimport * as i8 from \"@angular/material/icon\";\nimport * as i9 from \"ng2-file-upload\";\nimport * as i10 from \"@angular/material/button\";\nimport * as i11 from \"@ngx-translate/core\";\n\nfunction PhotoDialogBoxComponent_mat_error_4_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"mat-error\", 11)(1, \"mat-icon\");\n    i0.ɵɵtext(2, \"error_outline\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtext(3);\n    i0.ɵɵpipe(4, \"translate\");\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const ctx_r0 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate1(\" \", i0.ɵɵpipeBind1(4, 1, ctx_r0.error), \" \");\n  }\n}\n\nfunction PhotoDialogBoxComponent_img_7_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelement(0, \"img\", 12);\n    i0.ɵɵpipe(1, \"translate\");\n  }\n\n  if (rf & 2) {\n    const ctx_r1 = i0.ɵɵnextContext();\n    i0.ɵɵpropertyInterpolate(\"alt\", i0.ɵɵpipeBind1(1, 2, \"protego.dialog-box.alt\"));\n    i0.ɵɵproperty(\"src\", ctx_r1.sanitizer.bypassSecurityTrustUrl(ctx_r1.url), i0.ɵɵsanitizeUrl);\n  }\n}\n\nconst _c0 = function (a0) {\n  return {\n    \"protego-drag-over\": a0\n  };\n};\n\nfunction PhotoDialogBoxComponent_label_8_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r5 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementStart(0, \"label\", 13);\n    i0.ɵɵlistener(\"fileOver\", function PhotoDialogBoxComponent_label_8_Template_label_fileOver_0_listener($event) {\n      i0.ɵɵrestoreView(_r5);\n      const ctx_r4 = i0.ɵɵnextContext();\n      return ctx_r4.fileOver($event);\n    });\n    i0.ɵɵelementStart(1, \"div\", 14)(2, \"span\");\n    i0.ɵɵtext(3);\n    i0.ɵɵpipe(4, \"translate\");\n    i0.ɵɵelement(5, \"br\");\n    i0.ɵɵtext(6);\n    i0.ɵɵpipe(7, \"translate\");\n    i0.ɵɵelementEnd()()();\n  }\n\n  if (rf & 2) {\n    const ctx_r2 = i0.ɵɵnextContext();\n    i0.ɵɵproperty(\"ngClass\", i0.ɵɵpureFunction1(8, _c0, ctx_r2.hasDragOver))(\"uploader\", ctx_r2.uploader);\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate(i0.ɵɵpipeBind1(4, 4, \"protego.dialog-box.inst1\"));\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate(i0.ɵɵpipeBind1(7, 6, \"protego.dialog-box.inst2\"));\n  }\n}\n\nfunction PhotoDialogBoxComponent_input_9_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelement(0, \"input\", 15);\n  }\n\n  if (rf & 2) {\n    const ctx_r3 = i0.ɵɵnextContext();\n    i0.ɵɵproperty(\"uploader\", ctx_r3.uploader);\n  }\n}\n\nexport let PhotoDialogBoxComponent = /*#__PURE__*/(() => {\n  class PhotoDialogBoxComponent {\n    constructor(dialogRef, sanitizer, usersService, notificationService, tokenService, //@Optional() is used to prevent error if no data is passed\n    data) {\n      this.dialogRef = dialogRef;\n      this.sanitizer = sanitizer;\n      this.usersService = usersService;\n      this.notificationService = notificationService;\n      this.tokenService = tokenService;\n      this.data = data;\n      this.EXT_LIST = ['.jpg', '.png', '.gif'];\n      this.hasDragOver = false;\n      this.processing = false;\n      this.editmode = true;\n      this.urlChange = new EventEmitter();\n      this.uploader = new FileUploader({\n        url: 'https://protego-app.xyz/api/upload'\n      });\n\n      this.uploader.onAfterAddingFile = fileItem => {\n        if (this.validateFile(fileItem._file)) {\n          // set url in UI\n          let url = window.URL ? window.URL.createObjectURL(fileItem._file) : window.webkitURL.createObjectURL(fileItem._file);\n          this.url = url; // data to be posted\n\n          const formData = new FormData();\n          formData.append('file', fileItem._file, fileItem._file.name);\n          this.file = formData;\n        }\n      };\n    }\n\n    ngOnInit() {\n      this.username = this.tokenService.username;\n      this.getUserPhoto(this.username);\n    }\n\n    getUserPhoto(username) {\n      this.usersService.getUserPhoto(username).subscribe({\n        next: v => this.url = 'data:image/gif;base64,' + v,\n        error: e => console.log(e)\n      });\n    }\n\n    doAction() {\n      this.saveUserPhoto();\n      this.closeDialog();\n    }\n\n    closeDialog() {\n      this.dialogRef.close();\n    }\n\n    saveUserPhoto() {\n      this.usersService.updateUserPhoto(this.username, this.file).subscribe({\n        next: () => this.notificationService.success('Photo Updated'),\n        error: e => console.log(e)\n      });\n    }\n\n    fileOver(event) {\n      this.hasDragOver = event;\n    }\n\n    validateFile(file) {\n      const filename = file.name;\n      const size = file.size;\n      const ext = filename.substring(filename.lastIndexOf('.'));\n      let valid = true;\n      this.error = ''; // validate extension\n\n      if (this.EXT_LIST.indexOf(ext) < 0) {\n        valid = false;\n        this.error = 'protego.dialog-box.warn1';\n      } // validate size\n\n\n      if (size > 1024 * 500) {\n        valid = false;\n        this.error = 'protego.dialog-box.warn2';\n      }\n\n      return valid;\n    }\n\n  }\n\n  PhotoDialogBoxComponent.ɵfac = function PhotoDialogBoxComponent_Factory(t) {\n    return new (t || PhotoDialogBoxComponent)(i0.ɵɵdirectiveInject(i1.MatDialogRef), i0.ɵɵdirectiveInject(i2.DomSanitizer), i0.ɵɵdirectiveInject(i3.UsersService), i0.ɵɵdirectiveInject(i4.NotificationService), i0.ɵɵdirectiveInject(i5.TokenService), i0.ɵɵdirectiveInject(MAT_DIALOG_DATA, 8));\n  };\n\n  PhotoDialogBoxComponent.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n    type: PhotoDialogBoxComponent,\n    selectors: [[\"app-dialog-box\"]],\n    inputs: {\n      editmode: \"editmode\",\n      url: \"url\"\n    },\n    outputs: {\n      urlChange: \"urlChange\"\n    },\n    decls: 19,\n    vars: 19,\n    consts: [[\"mat-dialog-title\", \"\"], [\"mat-dialog-subtitle\", \"\"], [\"class\", \"protego-error-container\", 4, \"ngIf\"], [\"mat-dialog-content\", \"\"], [1, \"protego-profile-picture\"], [\"width\", \"300\", \"height\", \"300\", 3, \"src\", \"alt\", 4, \"ngIf\"], [\"for\", \"uploader-input\", \"ng2FileDrop\", \"\", 3, \"ngClass\", \"uploader\", \"fileOver\", 4, \"ngIf\"], [\"type\", \"file\", \"name\", \"file\", \"ng2FileSelect\", \"\", \"id\", \"uploader-input\", \"style\", \"display: none;\", 3, \"uploader\", 4, \"ngIf\"], [\"mat-dialog-actions\", \"\"], [\"mat-raised-button\", \"\", \"color\", \"primary\", 3, \"click\"], [\"mat-button\", \"\", \"mat-flat-button\", \"\", 3, \"click\"], [1, \"protego-error-container\"], [\"width\", \"300\", \"height\", \"300\", 3, \"src\", \"alt\"], [\"for\", \"uploader-input\", \"ng2FileDrop\", \"\", 3, \"ngClass\", \"uploader\", \"fileOver\"], [1, \"protego-infotext\"], [\"type\", \"file\", \"name\", \"file\", \"ng2FileSelect\", \"\", \"id\", \"uploader-input\", 2, \"display\", \"none\", 3, \"uploader\"]],\n    template: function PhotoDialogBoxComponent_Template(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵelementStart(0, \"h1\", 0);\n        i0.ɵɵtext(1);\n        i0.ɵɵpipe(2, \"translate\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(3, \"p\", 1);\n        i0.ɵɵtemplate(4, PhotoDialogBoxComponent_mat_error_4_Template, 5, 3, \"mat-error\", 2);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(5, \"div\", 3)(6, \"div\", 4);\n        i0.ɵɵtemplate(7, PhotoDialogBoxComponent_img_7_Template, 2, 4, \"img\", 5);\n        i0.ɵɵtemplate(8, PhotoDialogBoxComponent_label_8_Template, 8, 10, \"label\", 6);\n        i0.ɵɵtemplate(9, PhotoDialogBoxComponent_input_9_Template, 1, 1, \"input\", 7);\n        i0.ɵɵelementEnd()();\n        i0.ɵɵelementStart(10, \"div\", 8)(11, \"button\", 9);\n        i0.ɵɵlistener(\"click\", function PhotoDialogBoxComponent_Template_button_click_11_listener() {\n          return ctx.doAction();\n        });\n        i0.ɵɵpipe(12, \"translate\");\n        i0.ɵɵtext(13);\n        i0.ɵɵpipe(14, \"translate\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(15, \"button\", 10);\n        i0.ɵɵlistener(\"click\", function PhotoDialogBoxComponent_Template_button_click_15_listener() {\n          return ctx.closeDialog();\n        });\n        i0.ɵɵpipe(16, \"translate\");\n        i0.ɵɵtext(17);\n        i0.ɵɵpipe(18, \"translate\");\n        i0.ɵɵelementEnd()();\n      }\n\n      if (rf & 2) {\n        i0.ɵɵadvance(1);\n        i0.ɵɵtextInterpolate(i0.ɵɵpipeBind1(2, 9, \"protego.dialog-box.title\"));\n        i0.ɵɵadvance(3);\n        i0.ɵɵproperty(\"ngIf\", ctx.error);\n        i0.ɵɵadvance(3);\n        i0.ɵɵproperty(\"ngIf\", ctx.url);\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"ngIf\", ctx.editmode);\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"ngIf\", ctx.editmode);\n        i0.ɵɵadvance(2);\n        i0.ɵɵattribute(\"aria-label\", i0.ɵɵpipeBind1(12, 11, \"protego.dialog-box.aria1\"));\n        i0.ɵɵadvance(2);\n        i0.ɵɵtextInterpolate(i0.ɵɵpipeBind1(14, 13, \"protego.dialog-box.button1\"));\n        i0.ɵɵadvance(2);\n        i0.ɵɵattribute(\"aria-label\", i0.ɵɵpipeBind1(16, 15, \"protego.dialog-box.aria2\"));\n        i0.ɵɵadvance(2);\n        i0.ɵɵtextInterpolate(i0.ɵɵpipeBind1(18, 17, \"protego.dialog-box.button2\"));\n      }\n    },\n    directives: [i1.MatDialogTitle, i6.NgIf, i7.MatError, i8.MatIcon, i1.MatDialogContent, i9.FileDropDirective, i6.NgClass, i9.FileSelectDirective, i1.MatDialogActions, i10.MatButton],\n    pipes: [i11.TranslatePipe],\n    styles: [\".protego-profile-picture[_ngcontent-%COMP%]{position:relative;z-index:1;width:300px;height:300px;background-size:contain;border-radius:1em;margin:auto}.protego-profile-picture[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:300px;height:300px;position:absolute;z-index:2;border-radius:50%}.protego-profile-picture[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{width:300px;height:300px;position:relative;z-index:3;cursor:pointer}.protego-profile-picture[_ngcontent-%COMP%]   .protego-drag-over[_ngcontent-%COMP%]   .protego-infotext[_ngcontent-%COMP%]{color:#fff;border:dashed 5px white}.protego-profile-picture[_ngcontent-%COMP%]   .protego-infotext[_ngcontent-%COMP%]{position:absolute;margin-left:5px;margin-top:5px;height:290px;width:290px;vertical-align:middle;text-align:center;text-shadow:-1px 1px 0 #000,1px 1px 0 #000,1px -1px 0 #000,-1px -1px 0 #000;color:#fffc;border:dashed 3px rgba(255,255,255,.8);border-radius:50%;padding-top:110px;font-size:150%}.protego-profile-photo[_ngcontent-%COMP%]{position:absolute;width:100%;height:100%}.protego-page-container[_ngcontent-%COMP%]{width:60%;margin:auto;padding-top:1em}.protego-full-width[_ngcontent-%COMP%]{width:100%}.protego-card-header-image[_ngcontent-%COMP%]{background-size:cover}.protego-error-container[_ngcontent-%COMP%]{text-align:center}.protego-error-container[_ngcontent-%COMP%] > mat-icon[_ngcontent-%COMP%]{vertical-align:middle}.mat-dialog-content[_ngcontent-%COMP%]{min-height:300px}\"]\n  });\n  return PhotoDialogBoxComponent;\n})();","map":null,"metadata":{},"sourceType":"module"}