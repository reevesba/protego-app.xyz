{"ast":null,"code":"import { ActivatedRoute } from '@angular/router';\nimport { Store, select } from '@ngrx/store';\nimport { TokenService } from '../../../shared/services/token.service';\nimport { AuthService } from '../../../core/auth/auth.service';\nimport { selectConfirmed } from '../../../core/core.module';\nimport { NotificationService } from '../../../core/core.module';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@ngrx/store\";\nimport * as i2 from \"@angular/router\";\nimport * as i3 from \"../../../core/auth/auth.service\";\nimport * as i4 from \"../../../shared/services/token.service\";\nimport * as i5 from \"../../../core/core.module\";\nimport * as i6 from \"@angular/common\";\nimport * as i7 from \"@angular/material/card\";\nimport * as i8 from \"@angular/material/button\";\nimport * as i9 from \"@angular/material/progress-bar\";\nimport * as i10 from \"@ngx-translate/core\";\n\nfunction ConfirmEmailComponent_mat_card_1_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"mat-card\")(1, \"mat-card-title\");\n    i0.ɵɵtext(2);\n    i0.ɵɵpipe(3, \"translate\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(4, \"mat-card-subtitle\");\n    i0.ɵɵtext(5);\n    i0.ɵɵpipe(6, \"translate\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(7, \"mat-card-content\");\n    i0.ɵɵtext(8);\n    i0.ɵɵpipe(9, \"translate\");\n    i0.ɵɵelementEnd()();\n  }\n\n  if (rf & 2) {\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(i0.ɵɵpipeBind1(3, 3, \"protego.confirm-email.title\"));\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate(i0.ɵɵpipeBind1(6, 5, \"protego.confirm-email.confirmed\"));\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate(i0.ɵɵpipeBind1(9, 7, \"protego.confirm-email.info\"));\n  }\n}\n\nfunction ConfirmEmailComponent_ng_template_2_mat_progress_bar_16_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelement(0, \"mat-progress-bar\", 5);\n  }\n}\n\nfunction ConfirmEmailComponent_ng_template_2_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"mat-card\")(1, \"mat-card-title\");\n    i0.ɵɵtext(2);\n    i0.ɵɵpipe(3, \"translate\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(4, \"mat-card-subtitle\");\n    i0.ɵɵtext(5);\n    i0.ɵɵpipe(6, \"translate\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(7, \"mat-card-content\");\n    i0.ɵɵtext(8);\n    i0.ɵɵpipe(9, \"translate\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(10, \"mat-card-actions\")(11, \"button\", 3);\n    i0.ɵɵpipe(12, \"translate\");\n    i0.ɵɵtext(13);\n    i0.ɵɵpipe(14, \"translate\");\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(15, \"mat-card-footer\");\n    i0.ɵɵtemplate(16, ConfirmEmailComponent_ng_template_2_mat_progress_bar_16_Template, 1, 0, \"mat-progress-bar\", 4);\n    i0.ɵɵelementEnd()();\n  }\n\n  if (rf & 2) {\n    const ctx_r2 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(i0.ɵɵpipeBind1(3, 6, \"protego.confirm-email.apologies\"));\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate(i0.ɵɵpipeBind1(6, 8, \"protego.confirm-email.error\"));\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate(i0.ɵɵpipeBind1(9, 10, \"protego.confirm-email.detail\"));\n    i0.ɵɵadvance(3);\n    i0.ɵɵattribute(\"aria-label\", i0.ɵɵpipeBind1(12, 12, \"protego.confirm-email.aria\"));\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(i0.ɵɵpipeBind1(14, 14, \"protego.confirm-email.resend\"));\n    i0.ɵɵadvance(3);\n    i0.ɵɵproperty(\"ngIf\", ctx_r2.isLoading);\n  }\n}\n\nexport let ConfirmEmailComponent = /*#__PURE__*/(() => {\n  class ConfirmEmailComponent {\n    constructor(store, ar, authService, tokenService, notificationService) {\n      this.store = store;\n      this.ar = ar;\n      this.authService = authService;\n      this.tokenService = tokenService;\n      this.notificationService = notificationService;\n      this.isLoading = false;\n    }\n\n    ngOnInit() {\n      this.isConfirmed$ = this.store.pipe(select(selectConfirmed));\n      this.username = this.tokenService.username;\n      this.isConfirmed$.subscribe({\n        next: v => this.isConfirmed = v,\n        error: e => console.log(e)\n      });\n\n      if (!this.isConfirmed) {\n        this.ar.params.subscribe(params => {\n          if (params['id']) {\n            this.confirmEmail(params['id']);\n          }\n        });\n      }\n    }\n\n    confirmEmail(token) {\n      this.authService.confirmEmail(token).subscribe({\n        next: () => {\n          this.authService.refreshToken().subscribe({\n            next: () => this.isConfirmed = true,\n            error: e => console.log(e)\n          });\n        },\n        error: e => console.log(e)\n      });\n    }\n\n    resendEmail() {\n      this.isLoading = true;\n      this.authService.resendEmail(this.username).subscribe({\n        next: () => {\n          this.notificationService.success('Confirmation Email Sent!'), this.isLoading = false;\n        },\n        error: e => {\n          console.log(e), this.isLoading = false;\n        }\n      });\n    }\n\n  }\n\n  ConfirmEmailComponent.ɵfac = function ConfirmEmailComponent_Factory(t) {\n    return new (t || ConfirmEmailComponent)(i0.ɵɵdirectiveInject(i1.Store), i0.ɵɵdirectiveInject(i2.ActivatedRoute), i0.ɵɵdirectiveInject(i3.AuthService), i0.ɵɵdirectiveInject(i4.TokenService), i0.ɵɵdirectiveInject(i5.NotificationService));\n  };\n\n  ConfirmEmailComponent.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n    type: ConfirmEmailComponent,\n    selectors: [[\"confirm-email\"]],\n    decls: 4,\n    vars: 2,\n    consts: [[1, \"protego-page-wrapper\"], [4, \"ngIf\", \"ngIfElse\"], [\"elseTemplate\", \"\"], [\"mat-raised-button\", \"\", \"color\", \"primary\"], [\"mode\", \"query\", 4, \"ngIf\"], [\"mode\", \"query\"]],\n    template: function ConfirmEmailComponent_Template(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵelementStart(0, \"div\", 0);\n        i0.ɵɵtemplate(1, ConfirmEmailComponent_mat_card_1_Template, 10, 9, \"mat-card\", 1);\n        i0.ɵɵtemplate(2, ConfirmEmailComponent_ng_template_2_Template, 17, 16, \"ng-template\", null, 2, i0.ɵɵtemplateRefExtractor);\n        i0.ɵɵelementEnd();\n      }\n\n      if (rf & 2) {\n        const _r1 = i0.ɵɵreference(3);\n\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"ngIf\", ctx.isConfirmed)(\"ngIfElse\", _r1);\n      }\n    },\n    directives: [i6.NgIf, i7.MatCard, i7.MatCardTitle, i7.MatCardSubtitle, i7.MatCardContent, i7.MatCardActions, i8.MatButton, i7.MatCardFooter, i9.MatProgressBar],\n    pipes: [i10.TranslatePipe],\n    styles: [\".protego-page-wrapper[_ngcontent-%COMP%]{width:350px;margin:auto;padding-top:1em}\"]\n  });\n  return ConfirmEmailComponent;\n})();","map":null,"metadata":{},"sourceType":"module"}